# 기획 변경 이력 관리 가이드

## 목적

기획이 변경될 때 이전 동작과 현재 동작의 차이로 인해 발생하는 버그를 사전에 탐지하기 위한 가이드.

## 배경

코드만으로는 현재 동작이 "의도된 것"인지 "이전 기획의 잔재"인지 구분할 수 없다.
변경 전후를 명시적으로 기록해야 검증이 가능하다.

```
예시:
v1 기획: 수탁사 삭제 시 점검 레코드도 함께 삭제
v2 기획: 수탁사 삭제 시 점검은 "취소" 상태로 변경

→ 코드 일부에 v1 로직(cascade delete)이 남아있으면 버그
→ 변경 이력이 없으면 이것이 버그인지 판단 불가
```

## 스펙 문서 작성 규칙

### 파일 위치

```
docs/specs/
├── trustee.md        # 수탁사 도메인 스펙
├── contract.md       # 계약 도메인 스펙
└── inspection.md     # 점검 도메인 스펙
```

### 문서 구조

각 스펙 문서는 기능 단위로 다음 형식을 따른다.

```markdown
## [기능명]

**현재 동작**: 현재 기획 기준 동작 요약
**관련 코드**: 해당 로직이 구현된 파일 경로

### 변경 이력
| 날짜 | 변경 전 | 변경 후 | 이유 |
|------|---------|---------|------|
| YYYY-MM-DD | 이전 동작 | 현재 동작 | 변경 사유 |
```

### 작성 예시

```markdown
## 수탁사 삭제 시 점검 처리

**현재 동작**: 관련 점검을 "cancelled" 상태로 변경 (레코드 유지)
**관련 코드**: services/inspection/src/event-handlers.ts

### 변경 이력
| 날짜 | 변경 전 | 변경 후 | 이유 |
|------|---------|---------|------|
| 2025-01-15 | 점검 레코드 cascade DELETE | 상태를 cancelled로 변경 | 감사 추적을 위해 레코드 보존 필요 |
```

## 검증 프로세스

### 1. 기획 변경 발생 시

1. 해당 도메인 스펙 문서의 변경 이력 테이블에 행 추가
2. "현재 동작" 항목 업데이트
3. "관련 코드" 경로가 바뀌었으면 업데이트

### 2. 구현 완료 후 검증

Claude에게 다음과 같이 요청:

```
docs/specs/inspection.md의 변경 이력을 보고,
코드에 이전 동작이 남아있는지 확인해줘
```

Claude가 수행하는 검증:
- 변경 이력의 "변경 전" 동작이 코드에 남아있는지 탐색
- 관련 코드 경로 외에 동일 로직이 존재하는지 확인
- 테스트 코드가 이전 동작 기준으로 작성되어 있지 않은지 확인

### 3. 정기 점검

주기적으로 전체 스펙 문서를 기반으로 일괄 검증:

```
docs/specs/ 디렉토리의 모든 스펙 문서를 읽고,
변경 이력이 있는 항목에 대해 이전 동작이 코드에 남아있는지 확인해줘
```

## 관리 원칙

1. **변경이 있을 때만 기록한다** - 최초 구현은 기록할 필요 없음. 변경이 발생한 시점부터 이력 추가.
2. **변경 전/후를 구체적으로 작성한다** - "개선" 같은 모호한 표현 대신 동작 차이를 명확하게.
3. **관련 코드 경로를 반드시 명시한다** - 검증 시 탐색 범위를 좁히기 위함.
4. **이유를 남긴다** - 나중에 "왜 이렇게 바꿨는지"를 알 수 있어야 재변경 시 판단 가능.
